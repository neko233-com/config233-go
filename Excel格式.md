# Excel 配置格式说明

本项目支持的 Excel 配置格式，使用**固定行结构**，支持自动类型转换。

## 固定行结构

| 行号 (1-based) | 索引 (0-based) | 内容 | 说明 |
| :--- | :--- | :--- | :--- |
| 第 1 行 | index 0 | 注释 | 字段的中文描述 |
| 第 2 行 | index 1 | 中文字段名 | 供人类阅读 |
| 第 3 行 | index 2 | Client 字段名 | 客户端使用的字段名 |
| 第 4 行 | index 3 | **类型 (type)** | 定义每个字段的数据类型 |
| 第 5 行 | index 4 | **Server 字段名** | **核心**：映射到 Go 的字段名 |
| 第 6+ 行 | index 5+ | **数据** | 实际的配置数据 |

**重要**：第 1 列是标识列，会被跳过，从第 2 列开始读取字段。

## 支持的类型

| 类型值 | Go 类型 | 说明 |
| :--- | :--- | :--- |
| `int`, `int32` | `int` | 32位整数 |
| `long`, `int64` | `int64` | 64位整数 |
| `float`, `float32` | `float32` | 单精度浮点数 |
| `double`, `float64` | `float64` | 双精度浮点数 |
| `bool`, `boolean` | `bool` | 布尔值（支持 true/false/1/0/yes/no） |
| `string` | `string` | 字符串 |
| `json` | `string` | JSON字符串（保持原样，由调用方解析） |

## 示例 Excel 结构

| 标识列 | 物品id | 物品名称 | 品质 | 是否可出售 |
| :--- | :--- | :--- | :--- | :--- |
| 注释 | 物品的唯一ID | 物品名称 | 品质等级 | 是否可出售 |
| Client | itemId | itemName | quality | canSell |
| **type** | **long** | **string** | **int** | **boolean** |
| **Server** | **id** | **itemName** | **quality** | **canSell** |
| | 10001 | 金币 | 1 | FALSE |
| | 10002 | 钻石 | 2 | TRUE |

## 数据读取逻辑

1. 程序自动读取第一个 Working Sheet（工作表）
2. 使用**第 4 行（index 3）**作为类型信息
3. 使用**第 5 行（index 4）**作为 Server 字段名
4. 从**第 6 行（index 5）**开始读取数据
5. 跳过第 1 列（标识列），从第 2 列开始处理
6. 根据 type 行的类型信息，自动转换数据类型
7. 空字段名和空数据会被自动跳过

## 输出示例

```json
{
  "10001": {
    "id": 10001,
    "itemName": "金币",
    "quality": 1,
    "canSell": false
  },
  "10002": {
    "id": 10002,
    "itemName": "钻石",
    "quality": 2,
    "canSell": true
  }
}
```

**注意**：`id` 和 `quality` 是数字类型，`canSell` 是布尔类型。

## Struct 代码生成

config233 支持从 Excel 文件自动生成 Go struct 代码。

### 使用方法

```go
import "github.com/neko233-com/config233-go/pkg/config233"

// 从单个 Excel 文件生成
err := config233.GenerateStructFromExcel("path/to/config.xlsx", "output/dir")

// 从目录下所有 Excel 文件生成
err := config233.GenerateStructsFromExcelDir("excel/dir", "output/dir")
```

### 生成示例

从 `ItemConfig.xlsx` 生成的代码：

```go
// Code generated by config233. DO NOT EDIT.
// Source: ItemConfig.xlsx

package generated

// ItemConfig 配置结构体
type ItemConfig struct {
    ItemId int64 `json:"itemId"`
    ItemName string `json:"itemName"`
    Quality int `json:"quality"`
    Type int `json:"type"`
}
```

### KV 配置自动实现 IKvConfig

当配置名包含 `Kv`（不区分大小写）时，会自动生成 `IKvConfig` 接口实现：

```go
// Code generated by config233. DO NOT EDIT.
// Source: TestKvConfig.xlsx

package generated

import "github.com/neko233-com/config233-go/pkg/config233"

// TestKvConfig 配置结构体
type TestKvConfig struct {
    Id string `json:"id"`
    Value string `json:"value"`
}

// Ensure TestKvConfig implements IKvConfig interface
var _ config233.IKvConfig = (*TestKvConfig)(nil)

// GetValue 实现 IKvConfig 接口
func (c *TestKvConfig) GetValue() string {
    return c.Value
}
```

**注意**：生成的代码会自动导入 `config233` 包，并正确引用 `config233.IKvConfig` 接口。

### 使用 KV 配置

```go
import "github.com/neko233-com/config233-go/pkg/config233"

// 注册类型
config233.RegisterType[TestKvConfig]()

// 加载配置
manager := config233.NewConfigManager233("./config")
manager.LoadAllConfigs()

// 获取字符串列表（按逗号分隔）
list := config233.GetKvStringList[TestKvConfig]("list1", []string{"default"})
// 如果配置值为 "a,b,c"，返回 ["a", "b", "c"]
// 如果配置不存在或为空，返回默认值
```

### 生成规则

1. struct 名称 = Excel 文件名（首字母大写）
2. 字段名 = Server 行的值（首字母大写）
3. 字段类型 = 根据 type 行自动映射
4. 自动添加 `json` tag
5. KV 配置自动实现 `IKvConfig` 接口，并自动导入 `config233` 包
6. 如果 value 字段类型不是 string，会自动导入 `strconv` 包进行类型转换

