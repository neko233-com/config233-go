# v0.1.0 (2026-01-10)

## 🚀 重大改进

### 无锁化改造
- 完全移除 `cacheUpdateMutex` 互斥锁
- 使用 `atomic.Value` + CAS（Compare-And-Swap）实现无锁更新
- 采用 Copy-On-Write 策略保证线程安全
- 读操作完全无锁，支持海量并发访问

### 性能提升
- 基准测试显示读操作性能显著提升
- 并发测试通过（50读+5写同时进行）
- 适合读多写少的高并发场景

## 🐛 Bug 修复

### Excel 配置格式读取错误 🔥
- **问题**: Excel 读取时使用了错误的行索引
  - 错误地使用第 4 行（index 3）作为字段名，应该使用第 5 行（index 4）
  - 错误地从第 5 行（index 4）开始读数据，应该从第 6 行（index 5）开始
  - 错误地将第 1 列的标识符（"Server", "Client" 等）当作字段名
- **原因**: 从其他语言迁移代码时，直接使用了索引值，未考虑实际文件多了一行中文字段名
- **修复**: 
  - 正确使用 `rows[4]` 作为 Server 字段名（人类第 5 行）
  - 正确从 `rows[5:]` 开始读取数据（人类第 6 行开始）
  - 跳过第 1 列的标识符，从第 2 列开始处理字段
- **影响**: 修复后 Excel 配置能正确解析，`itemId`, `itemName` 等字段正确映射

**Excel 实际格式:**
```
第 1 行 (index 0): 注释
第 2 行 (index 1): 中文字段名
第 3 行 (index 2): Client 字段名
第 4 行 (index 3): 类型 (Type)
第 5 行 (index 4): Server 字段名 ← 使用这一行
第 6 行 (index 5): 数据开始 ← 从这里开始读数据
```

### JSON 配置加载修复
- **问题**: JSON 配置的 ID 提取逻辑错误，从 map 第一个值提取
- **修复**: 正确从 `id`/`ID`/`Id` 字段提取配置 ID
- **影响**: 修复后 `GetConfigById` 和 `GetKvStringList` 等方法正常工作

### 泛型查询增强
- **新增**: 支持 `map[string]interface{}` 到结构体的自动转换
- **实现**: 通过 JSON Marshal/Unmarshal 实现类型转换
- **好处**: 无需显式注册类型即可使用泛型查询

## 📝 代码优化

### 包名冲突处理
- 将内部 `json` 包重命名为 `jsonhandler` 避免与标准库冲突
- 保持代码可读性

### 测试覆盖
- ✅ 新增无锁并发测试 (`test/lockfree_test.go`)
- ✅ 修复 `TestConfigManager233_GetKvStringList` 测试
- ✅ 所有现有测试保持通过

## 🗑️ 清理工作

- 删除 `git 一键提交.cmd`（个人使用的临时脚本）

## 📚 文档

- 新增 `LOCK_FREE_UPGRADE.md` 详细说明无锁化改造
- 更新 `Excel格式.md` 正确说明行结构
- 包含技术细节、性能测试结果和使用注意事项

## ⚠️ Breaking Changes

无破坏性变更，完全向后兼容。

## 🔄 迁移指南

无需任何代码修改，直接升级即可。

---

**完整改动文件列表:**
- `pkg/config233/manager.go` - 核心无锁化改造，JSON ID 提取修复
- `pkg/config233/excel/handler.go` - Excel 行索引修复，跳过标识列
- `test/lockfree_test.go` - 新增无锁测试
- `test/manager_test.go` - 修复 KvStringList 测试
- `Excel格式.md` - 更新文档
- `LOCK_FREE_UPGRADE.md` - 新增技术文档

